function loadCardOptionsJSON(){try{if(cardOptionsJsonFormat!=""){cardOptionsJSON=$.parseJSON(cardOptionsJsonFormat)}}catch(a){logToConsole("loadCardOptionsJSON(): "+a.message)}}function getCardOptionFromCardType(){$("#cardType").change(function(a){currentCardType=(this.value!="")?this.value:"default";applyCardType(true);if(existFunction("inlineValidationAfterCardTypeChange")){inlineValidationAfterCardTypeChange()}})}function getCardTypeFromCardNumber(){$("#cardNumber").blur(function(c){var b=$.trim(this.value);this.value=b;if(currentCardPan!=b){var a=new RegExp("^[0-9]{12,20}$");if(a.exec(b)){$.ajax({beforeSend:function(d){$("#overlay").height($(document).height());$("#overlay").show();$("#waitPanel").show()}});$.ajax({url:"../cardOptions",type:"POST",data:{pan:b},dataType:"text"}).done(function(d){currentCardType=d;currentCardPan=b;applyCardType(true);if(existFunction("inlineValidationAfterCardTypeChange")){inlineValidationAfterCardTypeChange()}}).fail(function(d,e){currentCardType="default"}).always(function(d){$("#overlay").hide();$("#waitPanel").hide()})}}})}function repopulateMonthDropDown(b,d){if(monthsArray!=null){$("#"+b+" option[value!='']").remove();var a;for(var c=1;c<=12;c++){a=("00"+(c)).slice(-2);if(d=="mm"){$("<option value='"+a+"'>"+a+"</option>").appendTo($("#"+b))}else{$("<option value='"+a+"'>"+monthsArray[c-1]+"</option>").appendTo($("#"+b))}}}}function repopulateYearDropDown(e,g,k,d){var b=new Date();var f;var a=Number(b.getFullYear());var h;var j;if(g=="yyyy"){f=Number(b.getFullYear())}else{f=Number(b.getFullYear().toString().substring(2))}$("#"+e+" option[value!='']").remove();for(var c=0;c<k;c++){if(d){j=a+c;if(g.length==2){h=("00"+(f+c)).slice(-2)}else{h=j}}else{j=a-c;if(g.length==2){h=("00"+(f-c)).slice(-2)}else{h=j}}$("<option value='"+j+"'>"+h+"</option>").appendTo($("#"+e))}}function applyCardOptionsToFormElement(i,c,e,h,d,b,f,g){try{if(c=="selectDate"&&currentCardType!="default"){repopulateMonthDropDown(i+"Month",currentCardOption[i+"MonthFormat"]);repopulateYearDropDown(i+"Year",currentCardOption[i+"YearFormat"],currentCardOption[i+"YearRange"],g)}if(e){$("#"+i+"Section").show();if(c=="checkbox"){$("#"+i).prop("disabled",b);$("#"+i).prop("checked",f)}if(c=="selectDate"){if(h){$("#"+i+"MonthToolTip").css("visibility","visible");$("#"+i+"YearToolTip").css("visibility","visible")}else{$("#"+i+"MonthToolTip").css("visibility","hidden");$("#"+i+"YearToolTip").css("visibility","hidden")}}else{if(h){$("#"+i+"ToolTip").css("visibility","visible")}else{$("#"+i+"ToolTip").css("visibility","hidden")}}if(d){$("#"+i+"Section").addClass("required");$("#"+i+"Required").css("visibility","visible")}else{$("#"+i+"Section").removeClass("required");$("#"+i+"Required").css("visibility","hidden")}}else{$("#"+i+"Section").hide()}}catch(a){logToConsole("applyCardOptionsToFormElement("+i+"): "+a.message)}}function applyCardOptionsToFormElements(a){applyCardOptionsToFormElement("cardholderName","textbox",currentCardOption["fieldCardholderNameEnabled"],currentCardOption["tooltipCardholderNameEnabled"],currentCardOption["fieldCardHolderNameRequired"],null,null,null);applyCardOptionsToFormElement("cardNumber","textbox",currentCardOption["fieldCardNumberEnabled"],currentCardOption["tooltipCardNumberEnabled"],currentCardOption["fieldCardNumberRequired"],null,null,null);applyCardOptionsToFormElement("expiry","selectDate",currentCardOption["fieldExpiryDateEnabled"],currentCardOption["tooltipExpiryDateEnabled"],currentCardOption["fieldExpiryDateRequired"],null,null,true);applyCardOptionsToFormElement("start","selectDate",currentCardOption["fieldStartDateEnabled"],currentCardOption["tooltipStartDateEnabled"],currentCardOption["fieldStartDateRequired"],null,null,false);applyCardOptionsToFormElement("issue","textbox",currentCardOption["fieldIssueEnabled"],currentCardOption["tooltipIssueEnabled"],currentCardOption["fieldIssueRequired"],null,null,null);applyCardOptionsToFormElement("csc","textbox",currentCardOption["fieldCSCEnabled"],currentCardOption["tooltipCSCEnabled"],currentCardOption["fieldCSCRequired"],null,null,null);applyCardOptionsToFormElement("confirmCheck1","checkbox",currentCardOption["fieldConfirmCheck1Enabled"],currentCardOption["tooltipConfirmCheck1Enabled"],currentCardOption["fieldConfirmCheck1Required"],currentCardOption["fieldConfirmCheck1Disabled"],(a)?$("#confirmCheck1").prop("checked"):currentCardOption["fieldConfirmCheck1Checked"],null);applyCardOptionsToFormElement("confirmCheck2","checkbox",currentCardOption["fieldConfirmCheck2Enabled"],currentCardOption["tooltipConfirmCheck2Enabled"],currentCardOption["fieldConfirmCheck2Required"],currentCardOption["fieldConfirmCheck2Disabled"],(a)?$("#confirmCheck2").prop("checked"):currentCardOption["fieldConfirmCheck2Checked"],null)}function applyCardType(a){try{if(cardOptionsJSON){currentCardOption=cardOptionsJSON[currentCardType];if(!isTokenEditPanelUsed&&!isConfirmTokenPanelUsed){applyCardOptionsToFormElements(a)}}}catch(b){logToConsole("applyCardType("+a+"): "+b.message)}}function format(b,d){for(var a=0;a<d.length;a++){var c=new RegExp("\\{"+a+"\\}","gm");b=b.replace(c,d[a])}return b}function basketAnimation(a,g,b,d,f){try{var e=new Array();e.push(currentCardOption["surchargeAmount"]);if(currentCardOption["surchargeAmount"]!=""&&currentCardOption["totalAmount"]){a.text(currentCardOption["surchargeAmount"]);g.text(currentCardOption["totalAmount"]);$("#infoMessage").html(format(infoTemplateMsg,e));$("#infoMessage span").addClass("highlight");a.addClass("highlight");g.addClass("highlight");setTimeout(function(){$("#infoMessage span").removeClass("highlight");a.removeClass("highlight");g.removeClass("highlight")},2000);if(f){$("#infoMessagePanel").fadeIn("slow");b.fadeIn("slow");d.fadeIn("slow")}else{$("#infoMessagePanel").show();b.show();d.show()}}else{if(f){$("#infoMessagePanel").fadeOut("slow");b.fadeOut("slow");d.fadeOut("slow")}else{$("#infoMessagePanel").hide();b.hide();d.hide()}}}catch(c){logToConsole("basketAnimation(): "+c.message)}}function surcharges(a){applyCardType(false);if($("#purchaseDetailsPanel").length>0){basketAnimation($("#surchargeAmount"),$("#totalAmount"),$("#purchaseDetailsSurchargeAmount"),$("#purchaseDetailsTotalAmount"),true)}else{if($("#basketPanel").length>0){basketAnimation($("#basketSurchargeAmount"),$("#basketTotalAmount"),$("#basketSurchargeAmountPanel"),$("#basketTotalAmountPanel"),true)}}}function applySurcharges(){$("#cardType").change(surcharges);if(($("#cardType").length>0&&$("#cardType").prop("value")!="")||tokenCardType.length>0){surcharges()}}$(function(){loadCardOptionsJSON();if($("#cardType").length==0){getCardTypeFromCardNumber()}else{getCardOptionFromCardType()}applyCardType(true);applySurcharges()});